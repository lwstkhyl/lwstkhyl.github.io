---
layout: mypost
title: 使用我的GSE157827数据进行初步分析-2
category: other
subcategory: other-other
---

2026.1.15-2026.1.31研究进展

<!-- more -->

### 计算family-level计数矩阵

```r
library(Seurat)
library(tidyverse)
library(Matrix)
res_dir <- "C:\\Users\\17185\\Desktop\\hERV_calc\\GSE157827\\my_res"
seu <- readRDS("C:\\Users\\17185\\Desktop\\hERV_calc\\GSE157827\\my_data\\GSE157827_celltype.rds")
seu <- readRDS("C:\\Users\\17185\\Desktop\\hERV_calc\\GSE157827\\my_data\\GSE157827_astro.rds")
seu <- readRDS("C:\\Users\\17185\\Desktop\\hERV_calc\\GSE157827\\my_data\\GSE157827_astro_sub.rds")
```

```r
herv_loc <- GetAssayData(seu, assay = "HERV", layer = "counts")
feat <- rownames(herv_loc)
if(feat[1] == "--no-feature"){
  feat[1] <- "noFeature"
}
fam <- ifelse(grepl("-", feat), sub("-.*$", "", feat), feat)
fam <- factor(fam)
G <- Matrix::sparse.model.matrix(~ 0 + fam)
colnames(G) <- levels(fam)
herv_fam <- Matrix::t(G) %*% herv_loc
seu[["HERV_family"]] <- CreateAssayObject(counts = herv_fam)
all(Matrix::colSums(herv_loc) == Matrix::colSums(herv_fam))
# 标准化
DefaultAssay(seu) <- "HERV_family"
rna_counts  <- GetAssayData(seu, assay = "RNA",  slot = "counts")
herv_counts <- GetAssayData(seu, assay = "HERV_family", slot = "counts")
lib_rna <- Matrix::colSums(rna_counts)
herv_norm <- t(t(herv_counts) / lib_rna) * 10000
herv_norm@x <- log1p(herv_norm@x)
seu <- SetAssayData(seu, assay = "HERV_family", slot = "data", new.data = herv_norm)
DefaultAssay(seu) <- "RNA"
# 保存数据
saveRDS(
  seu, 
  file = "C:\\Users\\17185\\Desktop\\hERV_calc\\GSE157827\\my_data\\GSE157827_celltype.rds", 
  compress = "xz"
)
```

保存后的位点：

```
> herv_fam@Dimnames[[1]]
 [1] "ERV316A3"   "ERVL"       "ERVLB4"     "ERVLE"      "HARLEQUIN"  "HERV3"      "HERV30"     "HERV4"     
 [9] "HERV9"      "HERVE"      "HERVEA"     "HERVFC1"    "HERVFH19"   "HERVFH21"   "HERVFRD"    "HERVH"     
[17] "HERVH48"    "HERVI"      "HERVIP10F"  "HERVIP10FH" "HERVK11"    "HERVK11D"   "HERVK14C"   "HERVKC4"   
[25] "HERVL"      "HERVL18"    "HERVL32"    "HERVL40"    "HERVL66"    "HERVL74"    "HERVP71A"   "HERVS71"   
[33] "HERVW"      "HML1"       "HML2"       "HML3"       "HML4"       "HML5"       "HML6"       "HUERSP1"   
[41] "HUERSP2"    "HUERSP3"    "HUERSP3B"   "LTR19"      "LTR23"      "LTR25"      "LTR46"      "LTR57"     
[49] "MER101"     "MER34B"     "MER4"       "MER41"      "MER4B"      "MER61"      "noFeature"  "PABLA"     
[57] "PABLB"      "PRIMA4"     "PRIMA41"    "PRIMAX" 
```




### 关于上次的一些问题

重合的基因过少，差在哪里

多重比对的处理方法，多重比对是丢弃还是保留
